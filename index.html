<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-site-verification" content="TM2JLp2z2ivvAbxCRiY7ekyg7shRkm4LJ23ywpbje1U" />
    <title>The Elder Scrolls V: Skyrim Checklist</title>
    <style>
      /* ================== Variables ================== */
      :root {
        --bg-dark: #121212;
        --bg-panel: #212121;
        --bg-button: #2a2a2a;
        --bg-button-hover: #383838;
        --text-light: #ddd;
        --text-muted: #a0a0a0;
        --accent: #f7bf00;
        --link: #88c0d0;
      }

      /* ================== Global Styles ================== */
      * { box-sizing: border-box; }
      body {
        font-family: sans-serif;
        font-size: clamp(14px, 2vw, 16px);
        margin: 20px;
        background: var(--bg-dark);
        color: var(--text-light);
      }
      h1 { text-align: center; margin: 0 auto 20px; max-width: 1280px; border-radius: 8px; }
      ul { list-style: none; padding: 0; }
      li { margin: 5px 0 20px; }
      input[type="checkbox"]:checked + label { text-decoration: line-through; color: #555; }

      /* ================== Tags ================== */
      .tag { font-size: clamp(0.8em, 1.5vw, 0.95em); padding: 4px 8px; border-radius: 8px; display: inline-block; margin-left: 10px; color: var(--bg-dark); }
      .tagRequired { background: #ff8a80; }
      .tagOptional { background-color: #444; color: #ccc; }
      .tagGiver { background: #80d8ff; }
      .tagNote { color: #aaa; background: #1a1a1a; display: block; margin-left: 20px; margin-top: 4px; width: fit-content; max-width: 100%; word-wrap: break-word;}

      .tagMainQuests { background: #FFD700; }       /* Gold */
      .tagSideQuests { background: #87CEFA; }       /* Sky Blue */
      .tagDivineQuests { background: #00CED1; }     /* Dark Turquoise */
      .tagDeadricQuests { background: #8B0000; }    /* Dark Red */
      
      /* Regions */
      .tagAll { background: #808080; }          /* Gray - generic/any region */
      .tagEastmarch { background: #FF4500; }    /* OrangeRed - volcanic/mountain feel */
      .tagFalkreath { background: #228B22; } /* ForestGreen */
      .tagHaafingar { background: #4682B4; }     /* SteelBlue - coastal region */
      .tagHjaalmarch { background: #2E8B57; }    /* SeaGreen - marshy/wetlands */
      .tagThePale { background: #ADD8E6; }       /* LightBlue - cold, snowy */
      .tagTheReach { background: #8B4513; }      /* SaddleBrown - rugged/rocky */
      .tagTheRift { background: #DAA520; }       /* Goldenrod - fertile valleys */
      .tagWhiterun { background: #F0E68C; }      /* Khaki - central plains */
      .tagWinterhold { background: #B0C4DE; }    /* LightSteelBlue - icy/northern */
      .tagBlackreach { background: #4B0082; }    /* Indigo - underground/dark */
      .tagAny { background: #696969; }           /* DimGray - wildcard/any */

      /* Factions */
      .tagCollegeofWinterhold { background: #9370DB; } /* Medium Purple */
      .tagBardsCollege { background: #FF69B4; }     /* Hot Pink */
      .tagBlades { background: #A9A9A9; }           /* Dark Gray */
      .tagCompanions { background: #C0C0C0; }       /* Silver */
      .tagDarkBrotherhood { background: #4B0082; }  /* Indigo */
      .tagImperialLegion { background: #B22222; }   /* Firebrick */
      .tagThievesGuild { background: #556B2F; }     /* Dark Olive Green */
      .tagStormcloaks { background: #1E90FF; }      /* Dodger Blue */
      
      /* Dawnguard DLC */
      .tagMainDawnguardQuest { background: #1E90FF; } /* Dodger Blue */
      .tagSideDawnguardQuest { background: #87CEEB; } /* Sky Blue */
      .tagDawnguardFaction { background: #4682B4; }    /* Steel Blue */
      .tagVolkiharClan { background: #4B0082; }       /* Indigo */
      
      /* Dragonborn DLC */
      .tagMainDragonbornQuest { background: #FF8C00; } /* Dark Orange */
      .tagSideDragonbornQuest { background: #FFA500; } /* Orange */

      /* ================== Layout ================== */
      .content-container {
        display: flex;
        align-items: flex-start;
        gap: 20px;
        max-width: 1280px;
        width: 100%;
        margin: 60px auto 0;
        padding: 0 10px;
      }

      .sidebar-wrapper { width: 100%; max-width: 324px; flex-shrink: 0; }
      .sidebar {
        background: var(--bg-panel);
        border-radius: 8px;
        padding: 20px;
        width: 100%;
        color: #ccc;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .profile-bg {
        width: 100%; aspect-ratio: 3/4;
        background-image: url("https://images.igdb.com/igdb/image/upload/t_cover_big/co1vco.webp");
        background-size: cover;
        background-position: center;
        border-radius: 8px;
      }

      .content-section { flex-grow: 1; width: 100%; }
      .content { display: none; border: none; padding: 20px; background: var(--bg-panel); border-radius: 8px; max-width: 1280px; margin: auto; }
      .content.active { display: block; }
      .content ul { color: var(--text-muted); }

      .scrollable-list { max-height: 400px; overflow-y: auto; padding-right: 8px; scrollbar-color: var(--bg-button-hover) #1a1a1a; }

      /* ================== Tabs & Buttons ================== */
      .tab-box { background: var(--bg-panel); border-radius: 8px; padding: 10px; margin: 10px 0; }
      .tab-box2 { background: var(--bg-panel); border-radius: 8px; padding: 10px; margin-bottom: 20px; }
      .tab-buttons { display: flex; flex-direction: column; gap: 8px; }
      .tab-buttons2 { display: flex; flex-wrap: wrap; gap: 8px; overflow-x: auto; }
      .tab-button {
        padding: 10px; background: var(--bg-button); color: #ccc; border-radius: 6px; text-align: center;
        cursor: pointer; transition: background 0.2s; flex-shrink: 0;
      }
      .tab-button:hover, .tab-button.active { background: var(--bg-button-hover); color: var(--accent); }

      .progress { margin-bottom: 10px; }

      /* ================== Stats ================== */
      .stats-layout { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
      .stats-text { flex: 1; min-width: 200px; }
      .stats-chart { flex-shrink: 0; display: flex; justify-content: center; align-items: center; }

      /* ================== Responsive ================== */
      @media (max-width: 768px) {
        .content-container { flex-direction: column; }
        .sidebar-wrapper { margin-bottom: 75px; }
        .sidebar-wrapper, .content-section { width: 100%; }
      }
    </style>
  </head>

  <body>
    <!-- ================== Header ================== -->
    <h1>The Elder Scrolls V: Skyrim Checklist</h1>

    <!-- ================== Main Container ================== -->
    <div class="content-container">

      <!-- ================== Sidebar ================== -->
      <div class="sidebar-wrapper">
        <div class="sidebar"><div class="profile-bg"></div></div>
        <div class="tab-sidebar">
          <div class="tab-box">
            <div class="tab-buttons">
              <div class="tab-button" data-target="faq">FAQ</div>
              <div class="tab-button" data-target="stats">Stats</div>
              <div class="tab-button" onclick="exportChecklist()">Export Progress</div>
              <div class="tab-button" onclick="importChecklist()">Import Progress <input type="file" id="import-file" style="display: none;" /></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ================== Content ================== -->
      <div class="content-section">
        <div class="tab-box2">
          <div class="tab-buttons2">
            <div class="tab-button" data-target="main">Main</div>
            <div class="tab-button" data-target="side">Side</div>
            <div class="tab-button" data-target="baseGameFaction">Faction</div>
            <div class="tab-button" data-target="divine">Divines</div>
            <div class="tab-button" data-target="daedric">Daedric</div>
            <div class="tab-button" data-target="dawnguardDLCQuests">Dawnguard DLC</div>
            <div class="tab-button" data-target="dragonbornDLCQuests">Dragonborn DLC</div>
          </div>
        </div>

        <!-- Main Quests -->
        <div class="content active" id="main">
          <h2>Main Quests</h2>
          <div class="progress" id="main-Progress">Completed 0 / 0</div>
          <div class="scrollable-list"><ul id="main-Quests"></ul></div>
        </div>
        
        <!-- Side Quests -->
        <div class="content" id="side">
          <h2>Side Quests</h2>
          <div class="progress" id="side-Progress">Completed 0 / 0</div>
          <div id="side-filters" class="tab-buttons2" style="margin-bottom: 10px;"></div>
          <div class="scrollable-list"><ul id="side-Quests"></ul></div>
        </div>

        <!-- Base Game Factions -->
        <div class="content" id="baseGameFaction">
          <h2>Factions</h2>
          <div class="progress" id="baseGameFaction-Progress">Completed 0 / 0</div>
          <div id="baseGameFaction-filters" class="tab-buttons2" style="margin-bottom: 10px;"></div>
          <div class="scrollable-list"><ul id="baseGameFaction-Quests"></ul></div>
        </div>
        
        <!-- Divines Quests -->
        <div class="content" id="divine">
          <h2>Divines Quests</h2>
          <div class="progress" id="divine-Progress">Completed 0 / 0</div>
          <div class="scrollable-list"><ul id="divine-Quests"></ul></div>
        </div>

        <!-- Daedric Quests -->
        <div class="content" id="daedric">
          <h2>Daedric Quests</h2>
          <div class="progress" id="daedric-Progress">Completed 0 / 0</div>
          <div class="scrollable-list"><ul id="daedric-Quests"></ul></div>
        </div>

        <!-- Dawnguard DLC -->
        <div class="content" id="dawnguardDLCQuests">
          <h2>Dawnguard DLC</h2>
          <div class="progress" id="dawnguard-Progress">Completed 0 / 0</div>
          <div id="dawnguard-filters" class="tab-buttons2" style="margin-bottom: 10px;"></div>
          <div class="scrollable-list"><ul id="dawnguard-Quests"></ul></div>
        </div>
        
        <!-- Dragonborn DLC -->
        <div class="content" id="dragonbornDLCQuests">
          <h2>Dragonborn DLC</h2>
          <div class="progress" id="dragonborn-Progress">Completed 0 / 0</div>
          <div id="dragonborn-filters" class="tab-buttons2" style="margin-bottom: 10px;"></div>
          <div class="scrollable-list"><ul id="dragonborn-Quests"></ul></div>
        </div>

        <!-- FAQ -->
        <div class="content" id="faq">
          <h3>FAQ</h3>
          <p>This project was built by a fan and is inspired by similar checklists for other games like Dark Souls.</p>
          <p><strong>I have feedback, how can I contribute?</strong><br />You can visit the <span id="faq-link-container"></span> and report Issues or create a fork and submit a Pull Request.</p>
          <p><strong>Is this a guide?</strong><br />No, this is not a full walkthrough or guide. It simply helps you stay organized while playing by letting you check off content as you complete it.</p>
          <p><strong>How is progress saved?</strong><br />Your progress is saved locally in your browser using localStorage. This means your checklist will stay saved as long as you don’t clear your browser data.</p>
        </div>

        <!-- Stats -->
        <div class="content" id="stats">
          <h2>Quests Overview</h2>
          <div class="scrollable-list">
            <div class="stats-chart"><canvas id="combinedChart" style="width:250px; max-height:250px;"></canvas></div>
            <div class="stats-layout">
              <div class="stats-text">
                <div id="totalGames" style="margin-bottom:10px; font-size:1.1em;"></div>
                <div id="statusBreakdown"></div>
                <div id="completed-by-type" style="margin-top:20px;"><h2>Completed Quests</h2></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ================== Templates ================== -->
    <template id="github-link-template-faq">
      <a href="https://github.com/Lepehn/the-elder-scrolls-skyrim-checklist" target="_blank" style="color: var(--link); text-decoration: none;">GitHub repository</a>
    </template>
    <template id="github-link-template-footer">
      <a href="https://github.com/Lepehn/the-elder-scrolls-skyrim-checklist" target="_blank" style="color: var(--link); text-decoration: none;">report an issue on GitHub</a>
    </template>

    <!-- ================== Scripts ================== -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // ================== Tab Switching ==================
      document.querySelectorAll(".tab-button").forEach(button => {
        button.addEventListener("click", () => {
          const target = button.dataset.target;
          if (!target) return;

          document.querySelectorAll(".tab-button").forEach(btn => btn.classList.remove("active"));
          button.classList.add("active");

          document.querySelectorAll(".content").forEach(c => c.classList.remove("active"));
          document.getElementById(target).classList.add("active");

          if(target === "stats") updateAllStats();
        });
      });

      // ================== Quest Constructor ==================
      function quests(title, note, tag = null, optional = false) {
        const q = { title, note };
        if(tag) q.tag = tag;
        if(optional) q.optional = "Optional";
        return q;
      }
      
     	/* To Add New Quest
		- Add quest data
		- add filters
		- add html
		- update questCategories
		- update updateProgressByType
		- update stats allQuests
		*/

      // ================== Filters ==================
      const regions = ["All","Eastmarch", "Falkreath","Haafingar","Hjaalmarch","The Pale","The Reach","The Rift", "Whiterun", "Winterhold", "Blackreach", "Any"];
      const baseFactions = ["All","College of Winterhold","Bards College","Blades","Companions","Dark Brotherhood","Thieves Guild", "Imperial Legion", "Stormcloaks"];
      const dawnguardDLC = ["All","Main Dawnguard Quest","Side Dawnguard Quest","Dawnguard Faction","Volkihar Clan"];
      const dragonbornDLC = ["All","Main Dragonborn Quest","Side Dragonborn Quest"];

      // ================== Unified Quest Configuration ==================
      const questCategories = [
        // ================== Main Quests ================== 
        {
          key: "main",
          label: "Main Quests",
          color: "#FF4500",
          quests: [
            quests("Unbound", "Escape Imperial custody and a dragon raid."),
            quests("Before the Storm", "Inform the Jarl of Whiterun about the dragon attack on Helgen."),
            quests("Bleak Falls Barrow", "Retrieve the Dragonstone."),
            quests("Dragon Rising", "Investigate a Dragon sighting near Whiterun."),
            quests("The Way of the Voice", "Meet the Greybeards."),
            quests("The Horn of Jurgen Windcaller", "Retrieve a Greybeard artifact from Ustengrav."),
            quests("A Blade in the Dark", "Prove you are Dragonborn to Delphine by slaying the dragon Sahloknir."),
            quests("Diplomatic Immunity", "Infiltrate a party at the Thalmor Embassy."),
            quests("A Cornered Rat", "Locate Esbern."),
            quests("Alduin's Wall", "Locate the prophecy within Sky Haven Temple."),
            quests("The Throat of the World", "Receive a lesson from Paarthurnax."),
            quests("Elder Knowledge", "Locate an Elder Scroll."),
            quests("Alduin's Bane", "Exploit the Time Wound to learn Dragonrend."),
            quests("The Fallen", "Capture and interrogate one of Alduin's allies."),
            quests("Paarthurnax", "Deal with a potential threat.", null, true),
            quests("Season Unending", "Enforce a ceasefire to secure Dragonsreach.", null, true),
            quests("The World-Eater's Eyrie", "Battle through Skuldafn Temple to reach Alduin's portal to Sovngarde."),
            quests("Soverngarde", "Seek out Alduin within Sovngarde."),
            quests("Dragonslayer", "Put an end to the World Eater.")
          ]},
        // ================== Side Quests ================== 
        {
          key: "side",
          label: "Side Quests",
          color: "#FFA500",
          filters: regions,
          quests: [
            // Eastmarch
            quests("A Love Beyond Death", "Side quest in Eastmarch.", "Eastmarch"),
            quests("Argonian Dock Workers", "Side quest in Eastmarch.", "Eastmarch"),
            quests("Blood on the Ice", "Investigate murders in Windhelm.", "Eastmarch"),
            quests("Find Roggi Knot-Beard's Ancestral Shield", "Retrieve Roggi's ancestral shield.", "Eastmarch"),
            quests("Find the Thalmor Assassin", "Track down a Thalmor assassin.", "Eastmarch"),
            quests("Harsh Master", "Complete tasks in Eastmarch.", "Eastmarch"),
            quests("Queen Freydis's Sword", "Locate Queen Freydis's sword.", "Eastmarch"),
            quests("Repairing the Phial", "Assist with restoring The White Phial.", "Eastmarch"),
            quests("Rise in the East", "Various tasks in Eastmarch.", "Eastmarch"),
            quests("Shahvee's Amulet", "Recover Shahvee's amulet.", "Eastmarch"),
            quests("The Forgemaster's Fingers", "Find the Forgemaster's fingers.", "Eastmarch"),
            quests("The White Phial", "Complete The White Phial questline.", "Eastmarch"),
            quests("That Was Always There", "Discover a hidden mystery in Eastmarch.", "Eastmarch"),

            // Falkreath
            quests("Dark Ancestor", "Side quest in Falkreath.", "Falkreath"),
            quests("Hunter and Hunted", "Side quest in Falkreath.", "Falkreath"),

            // Haafingar
            quests("Dragon's Breath Mead", "Side quest in Haafingar.", "Haafingar"),
            quests("Kill the Vampire", "Side quest in Haafingar.", "Haafingar"),
            quests("Lights Out!", "Side quest in Haafingar.", "Haafingar"),
            quests("Return to Grace", "Side quest in Haafingar.", "Haafingar"),
            quests("Tending the Flames", "Side quest in Haafingar.", "Haafingar"),
            quests("The Man Who Cried Wolf", "Side quest in Haafingar.", "Haafingar"),
            quests("The Spiced Wine", "Side quest in Haafingar.", "Haafingar"),
            quests("The Wolf Queen Awakened", "Side quest in Haafingar.", "Haafingar"),

            // Hjaalmarch
            quests("Falion's Secret", "Side quest in Hjaalmarch.", "Hjaalmarch"),
            quests("For the Good of Morthal", "Side quest in Hjaalmarch.", "Hjaalmarch"),
            quests("Forbidden Legend", "Side quest in Hjaalmarch.", "Hjaalmarch"),
            quests("Laid to Rest", "Side quest in Hjaalmarch.", "Hjaalmarch"),
            quests("Rising at Dawn", "Side quest in Hjaalmarch.", "Hjaalmarch"),

            // The Pale
            quests("A Scroll For Anska", "Side quest in The Pale.", "The Pale"),
            quests("Kill the Giant", "Side quest in The Pale.", "The Pale"),
            quests("Salty Sea-Dogs", "Side quest in The Pale.", "The Pale"),
            quests("Silenced Tongues", "Side quest in The Pale.", "The Pale"),
            quests("The Pale Lady", "Side quest in The Pale.", "The Pale"),
            quests("Visit the Museum in Dawnstar", "Side quest in The Pale.", "The Pale"),

            // The Reach
            quests("A Few Words with You", "Side quest in The Reach.", "The Reach"),
            quests("The Steward's Potion", "Side quest in The Reach.", "The Reach"),
            quests("Buy Dwarven artifact", "Side quest in The Reach.", "The Reach"),
            quests("Coated in Blood", "Side quest in The Reach.", "The Reach"),
            quests("Calcelmo's Ring", "Side quest in The Reach.", "The Reach"),
            quests("Evil in Waiting", "Side quest in The Reach.", "The Reach"),
            quests("Kolskeggr Mine", "Side quest in The Reach.", "The Reach"),
            quests("Dibella's Shine", "Side quest in The Reach.", "The Reach"),
            quests("Nimhe, the Poisoned One", "Side quest in The Reach.", "The Reach"),
            quests("No One Escapes Cidhna Mine", "Side quest in The Reach.", "The Reach"),
            quests("Recover Hrolfdir's Shield", "Side quest in The Reach.", "The Reach"),
            quests("Rogatus's Letter", "Side quest in The Reach.", "The Reach"),
            quests("Search and Seizure", "Side quest in The Reach.", "The Reach"),
            quests("Skilled Apprenticeship", "Side quest in The Reach.", "The Reach"),
            quests("Soljund's Sinkhole", "Side quest in The Reach.", "The Reach"),
            quests("The Forsworn Conspiracy", "Side quest in The Reach.", "The Reach"),
            quests("The Ghost of Old Hroldan", "Side quest in The Reach.", "The Reach"),
            quests("The Heart of Dibella", "Side quest in The Reach.", "The Reach"),
            quests("The Lost Expedition", "Side quest in The Reach.", "The Reach"),

            // The Rift
            quests("A Chance Arrangement", "Side quest in The Rift.", "The Rift"),
            quests("Bow to the Master", "Side quest in The Rift.", "The Rift"),
            quests("Caught Red Handed", "Side quest in The Rift.", "The Rift"),
            quests("Climb The Steps", "Side quest in The Rift.", "The Rift"),
            quests("Infiltration", "Side quest in The Rift.", "The Rift"),
            quests("Few and Far Between", "Side quest in The Rift.", "The Rift"),
            quests("Flight or Fight", "Side quest in The Rift.", "The Rift"),
            quests("Grin and Bear It", "Side quest in The Rift.", "The Rift"),
            quests("Grimsever's Return", "Side quest in The Rift.", "The Rift"),
            quests("Hunt and Gather", "Side quest in The Rift.", "The Rift"),
            quests("Ice Cold", "Side quest in The Rift.", "The Rift"),
            quests("Kyne's Sacred Trials", "Side quest in The Rift.", "The Rift"),
            quests("Promises to Keep", "Side quest in The Rift.", "The Rift"),
            quests("Repentance", "Side quest in The Rift.", "The Rift"),
            quests("Ringmaker", "Side quest in The Rift.", "The Rift"),
            quests("Sealing the Deal", "Side quest in The Rift.", "The Rift"),
            quests("Siege on the Dragon Cult", "Side quest in The Rift.", "The Rift"),
            quests("Smooth Jazbay", "Side quest in The Rift.", "The Rift"),
            quests("Special Delivery (Bolli)", "Side quest in The Rift.", "The Rift"),
            quests("Special Delivery (Sylgja)", "Side quest in The Rift.", "The Rift"),
            quests("Stoking the Flames", "Side quest in The Rift.", "The Rift"),
            quests("Supply and Demand", "Side quest in The Rift.", "The Rift"),
            quests("Taking Care of Business", "Side quest in The Rift.", "The Rift"),
            quests("The Book of Love", "Side quest in The Rift.", "The Rift"),
            quests("The Lover's Requital", "Side quest in The Rift.", "The Rift"),
            quests("The Raid", "Side quest in The Rift.", "The Rift"),
            quests("The Straw that Broke", "Side quest in The Rift.", "The Rift"),
            quests("Unfathomable Depths", "Side quest in The Rift.", "The Rift"),

            // Whiterun
            quests("A Lovely Letter", "Side quest in Whiterun.", "Whiterun"),
            quests("Andurs' Arkay Amulet", "Side quest in Whiterun.", "Whiterun"),
            quests("Argonian Ale Extraction", "Side quest in Whiterun.", "Whiterun"),
            quests("Delayed Burial", "Side quest in Whiterun.", "Whiterun"),
            quests("Erik the Slayer", "Side quest in Whiterun.", "Whiterun"),
            quests("Greatsword for a Great Man", "Side quest in Whiterun.", "Whiterun"),
            quests("In My Time of Need", "Side quest in Whiterun.", "Whiterun"),
            quests("Salt For Arcadia", "Side quest in Whiterun.", "Whiterun"),
            quests("Missing in Action", "Side quest in Whiterun.", "Whiterun"),
            quests("The Blessings of Nature", "Side quest in Whiterun.", "Whiterun"),
            quests("The Golden Claw", "Side quest in Whiterun.", "Whiterun"),
            quests("Ysolda's Shipment", "Side quest in Whiterun.", "Whiterun"),

            // Winterhold
            quests("Helm of Winterhold", "Side quest in Winterhold.", "Winterhold"),
            quests("Forgotten Names", "Side quest in Winterhold.", "Winterhold"),

            // Blackreach
            quests("A Return To Your Roots", "Side quest in Blackreach.", "Blackreach"),

            // Any region
            quests("Ancestral Worship", "Side quest in any region", "Any"),
            quests("Becoming Thane", "Side quest in any region.", "Any"),
          ]},
        // ================== Base Game Factions ================== 
        {
          key: "baseGameFaction",
          label: "Factions",
          color: "#4682B4",
          filters: baseFactions,
          quests: [
            // College of Winterhold
            quests("College Objective Quest", "Visit the College of Winterhold.", "College of Winterhold"),
            quests("First Lessons", "Join the College of Winterhold.", "College of Winterhold"),
            quests("Under Saarthal", "Uncover the mysteries beneath this ancient ruin.", "College of Winterhold"),
            quests("Hitting the Books", "Find the books needed to identify the artifact found in Saarthal.", "College of Winterhold"),
            quests("Good Intentions", "Find and consult the Augur of Dunlain.s", "College of Winterhold"),
            quests("Revealing the Unseen", "Discover the location of Magnus' staff.", "College of Winterhold"),
            quests("Containment", "Deal with the aftermath of the Eye's power surge.", "College of Winterhold"),
            quests("The Staff of Magnus", "Retrieve the Staff of Magnus.", "College of Winterhold"),
            quests("The Eye of Magnus", "Reclaim the College and contain the Eye.", "College of Winterhold"),
            quests("Arniel's Endeavor", "Uncover an ancient Dwemer secret.", "College of Winterhold"),
            quests("Brelyna's Practice", "Help Brelyna Maryon test spells.", "College of Winterhold"),
            quests("J'zargo's Experiment", "Help J'zargo test out a fiery new spell.", "College of Winterhold"),
            quests("Onmund's Request", "Help Onmund negotiate the return of a family amulet.", "College of Winterhold"),
            quests("Out of Balance", "Purify the focus points for magical energy around the College.", "College of Winterhold"),
            quests("Rejoining the College", "Make amends for breaking the College of Winterhold rules.", "College of Winterhold"),

            // Bards College
            quests("Tending the Flames", "Unveil the truth about a King; become a member of Bards College.", "Bards College"),
            quests("Investigate the Bards College", "Investigate the Bards College.", "Bards College"),
            quests("Finn's Lute", "Return an invaluable lute to Inge Six Fingers.", "Bards College"),
            quests("Pantea's Flute", "Find a missing flute for Pantea.", "Bards College"),
            quests("Rjorn's Drum", "Retrieve a drum for Giraud Gemane.", "Bards College"),

            // Blades
            quests("Rebuilding the Blades", "Recruit new members for the Blades.", "Blades"),
            quests("Dragon Hunting", "Kill a dragon at its lair.", "Blades"),
            quests("Dragon Research", "Help Esbern complete his research on dragons.", "Blades"),

            // Companions
            quests("Take Up Arms", "Prove you are worthy to join the Companions.", "Companions"),
            quests("Proving Honor", "Claim a Fragment of Wuuthrad from Dustman's Cairn.", "Companions"),
            quests("The Silver Hand", "Join the Circle and clear Gallows Rock of werewolf hunters.", "Companions"),
            quests("Blood's Honor", "Claim the head of a Glenmoril Witch for Kodlak Whitemane.", "Companions"),
            quests("Purity of Revenge", "Retrieve the Fragments of Wuuthrad.", "Companions"),
            quests("Glory of the Dead", "Cure Kodlak's spirit and prove yourself as a true Companion.", "Companions"),

            // Dark Brotherhood
            quests("Delayed Burial", "Convince farmer to help a stranded jester outside of Whiterun.", "Dark Brotherhood", true),
            quests("Innocence Lost", "Help an orphaned child avoid being returned to a caretaker.", "Dark Brotherhood"),
            quests("With Friends Like These...", "Show you are willing to kill on command.", "Dark Brotherhood"),
            quests("Sanctuary", "Pick up your first contracts as a Brotherhood member.", "Dark Brotherhood"),
            quests("Mourning Never Comes", "Help Muiri get her revenge.", "Dark Brotherhood"),
            quests("Whispers in the Dark", "Spy on the Night Mother's keeper.", "Dark Brotherhood"),
            quests("The Silence Has Been Broken", "Meet Amaund Motierre inside Volunruud.", "Dark Brotherhood"),
            quests("Bound Until Death", "Assassinate Vittoria Vici at her own wedding.", "Dark Brotherhood"),
            quests("Breaching Security", "Kill and frame the son of a high-ranking Imperial guard.", "Dark Brotherhood"),
            quests("The Cure for Madness", "Confront the traitor among the Dark Brotherhood.", "Dark Brotherhood"),
            quests("Recipe for Disaster", "Assume the identity of the famous Gourmet.", "Dark Brotherhood"),
            quests("To Kill an Empire", "Attempt to assassinate the Emperor.", "Dark Brotherhood"),
            quests("Death Incarnate", "Assist Brotherhood members in the fight against assault.", "Dark Brotherhood"),
            quests("Hail Sithis!", "Fulfill the biggest contract in Brotherhood history.", "Dark Brotherhood"),

            // Thieves Guild
            quests("A Chance Arrangement", "Help teach a merchant to mind his own business.", "Thieves Guild"),
            quests("Taking Care of Business", "Help Brynjolf collect some debts for the Thieves Guild.", "Thieves Guild"),
            quests("Loud and Clear", "Send a message to a former Thieves Guild client.", "Thieves Guild"),
            quests("Dampened Spirits", "Put Maven Black-Briar's competition out of business.", "Thieves Guild"),
            quests("Scoundrel's Folly", "Squeeze a reluctant informer for information.", "Thieves Guild"),
            quests("Speaking With Silence", "Track down the Dunmer behind the Guild's misfortunes.", "Thieves Guild"),
            quests("Hard Answers", "Help translate Gallus' journal.", "Thieves Guild"),
            quests("The Pursuit", "Break into Mercer Frey's house and search for clues.", "Thieves Guild"),
            quests("Trinity Restored", "Become one of the Nightingales, Nocturnal's guardians.", "Thieves Guild"),
            quests("Blindsighted", "Stop Mercer Frey.", "Thieves Guild"),
            quests("Darkness Returns", "Return the Skeleton Key to its rightful place.", "Thieves Guild"),
            quests("Under New Management", "Become the Guild master of the Thieves Guild.", "Thieves Guild"),

            // Imperial Legion
            quests("Joining the Legion", "Prove yourself worthy to join the Imperial Legion.", "Imperial Legion"),
            quests("The Jagged Crown", "Find the Jagged Crown for the Imperials.", "Imperial Legion"),
            quests("Message to Whiterun", "Deliver the message that will decide Whiterun's allegiance.", "Imperial Legion"),
            quests("Battle for Whiterun", "Protect Whiterun from the Stormcloak invasion.", "Imperial Legion"),
            quests("Reunification of Skyrim", "Re-unite Skyrim under the leadership of the Empire.", "Imperial Legion"),

            // Stormcloaks
            quests("Joining the Stormcloaks", "Prove yourself worthy of being a Stormcloak rebel.", "Stormcloaks"),
            quests("The Jagged Crown", "Find this crown for Ulfric Stormcloak.", "Stormcloaks"),
            quests("Message to Whiterun", "Deliver an axe to the Jarl of Whiterun.", "Stormcloaks"),
            quests("Battle for Whiterun", "Take Whiterun in the name of the Stormcloaks.", "Stormcloaks"),
            quests("Liberation of Skyrim", "Overarching quest governing the individual battles of the war.", "Stormcloaks")
          ]},
        // ================== Divine Quests ==================
        {
          key: "divine",
          label: "Divines Quests",
          color: "#2E8B57",
          quests: [
            quests("Kyne's Sacred Trials", "Participate in the trials by hunting the guardian beasts of Skyrim."),
            quests("The Blessings of Nature", "Restore the Gildergreen for Danica Pure-Spring in Whiterun."),
            quests("The Book of Love", "Help the Temple of Mara of Riften spread the cause of love."),
            quests("The Heart of Dibella", "Find a new Sybil for the Temple of Dibella in Markarth.")
          ]},
          
        // ================== Daedric Quests ==================
        {
          key: "daedric",
          label: "Daedric Quests",
          color: "#8A2BE2",
          quests: [
            quests("The Black Star", "Visit the Shrine of Azura."),
            quests("Boethiah's Calling", "Become Boethiah's new champion."),
            quests("A Daedra's Best Friend", "Help Barbas reunite with his master."),
            quests("Discerning the Transmundane", "Ask Urag about the insane book."),
            quests("Ill Met By Moonlight", "Hunt in Hircine's name."),
            quests("The Cursed Tribe", "Help lift the curse placed on the Orcs of Largashbur by Malacath."),
            quests("Pieces of the Past", "Retrieve and reforge the scattered pieces of Mehrunes' Razor."),
            quests("The Break of Dawn", "Find Meridia's Beacon and cleanse her temple of undead."),
            quests("The Whispering Door", "Investigate Nelkir's story of a Whispering Lady."),
            quests("The House of Horrors", "Help Molag Bal take revenge upon a servant of Boethiah."),
            quests("The Taste of Death", "Prepare a Feast for the Lady of Decay."),
            quests("Darkness Returns", "Return the Skeleton Key to its rightful place."),
            quests("The Only Cure", "Slay an apostate worshipper for the Daedra Lord Peryite."),
            quests("A Night To Remember", "Find your lost friend, Sam, as you recover from a bad hangover."),
            quests("The Mind of Madness", "Gain access to and solve the mystery of the Pelagius Wing."),
            quests("Waking Nightmare", "Relieve the people of Dawnstar from Vaermina's curse.")
          ]},
        // ================== Dawnguard DLC ==================
        {
          key: "dawnguard",
          label: "Dawnguard DLC",
          color: "#2E8B57",
          filters: dawnguardDLC,
          quests: [
            quests("Dawnguard", "Join the Dawnguard.", "Main Dawnguard Quest"),
            quests("Awakening", "Find out what the vampires are looking for.", "Main Dawnguard Quest"),
            quests("Bloodline", "Choose your side!", "Main Dawnguard Quest"),
            quests("A New Order (Dawnguard)", "Recruit Isran's old allies.", "Main Dawnguard Quest"),
            quests("Prophet (Dawnguard)", "Find and rescue a Moth Priest.", "Main Dawnguard Quest"),
            quests("The Bloodstone Chalice (Vampires)", "Fill the Bloodstone Chalice from the Bloodspring at Redwater Den.", "Main Dawnguard Quest"),
            quests("Prophet (Vampires)", "Locate a Moth Priest.", "Main Dawnguard Quest"),
            quests("Chasing Echoes", "Explore Castle Volkihar.", "Main Dawnguard Quest"),
            quests("Scroll Scouting", "Obtain all three Elder Scrolls.", "Main Dawnguard Quest"),
            quests("Beyond Death", "Search for Valerica in the Soul Cairn.", "Main Dawnguard Quest"),
            quests("Seeking Disclosure", "Bring the Elder Scrolls to Dexion.", "Main Dawnguard Quest"),
            quests("Unseen Visions", "Perform a ceremony to read the Elder Scroll.", "Main Dawnguard Quest"),
            quests("Touching the Sky", "Find and retrieve Auriel's Bow.", "Main Dawnguard Quest"),
            quests("Kindred Judgment", "Confront Lord Harkon.", "Main Dawnguard Quest"),

            // Dawnguard Side Quests
            quests("Durnehviir", "Learn a dragon shout from Durnehviir.", "Side Dawnguard Quest"),
            quests("Forgotten Vale Books Quest", "Find the Ancient Falmer Tome.", "Side Dawnguard Quest"),
            quests("Impatience of a Saint", "Collect the ten missing pages of Saint Jiub's Opus.", "Side Dawnguard Quest"),
            quests("Lost to the Ages", "Search for the Dwemer's Aetherium Forge.", "Side Dawnguard Quest"),
            quests("Soul Cairn Horse Quest", "Find Arvak's skull.", "Side Dawnguard Quest"),
            quests("Surgery", "Change your appearance.", "Side Dawnguard Quest"),

            // Dawnguard Faction
            quests("Ancient Technology", "Retrieve Dwemer schematics to improve technology.", "Dawnguard Faction"),
            quests("Bolstering the Ranks", "Find Florentius Baenius and recruit him into the Dawnguard.", "Dawnguard Faction"),
            quests("Cleansing Light", "Kill the boss of a vampire lair.", "Dawnguard Faction"),
            quests("Hide and Seek", "Kill a vampire masquerading as a citizen.", "Dawnguard Faction"),
            quests("Hunting the Monster", "Destroy the vampire target.", "Dawnguard Faction"),
            quests("A Jarl's Justice", "Kill a vampire masquerading as a visiting advisor.", "Dawnguard Faction"),
            quests("Lost Relic", "Retrieve a relic of the original Dawnguard.", "Dawnguard Faction"),
            quests("Preemptive Strike", "Destroy the vampire before it turns its allies.", "Dawnguard Faction"),
            quests("Rescue", "Rescue a victim from vampires.", "Dawnguard Faction"),

            // Volkihar Clan
            quests("Amulets of Night Power", "Retrieve the Amulets of Night Power.", "Volkihar Clan"),
            quests("Ancient Power", "Retrieve vampire parts.", "Volkihar Clan"),
            quests("Culling the Beast", "Kill the thin-blooded vampires.", "Volkihar Clan"),
            quests("Deceiving the Herd", "Frame the Dawnguard for murder.", "Volkihar Clan"),
            quests("Destroying the Dawnguard", "Kill the Dawnguard leaders.", "Volkihar Clan"),
            quests("The Gift", "Turn your spouse into a creature of the night.", "Volkihar Clan"),
            quests("The Hunt", "Kill the Dawnguard spy.", "Volkihar Clan"),
            quests("New Allegiances", "Turn the target into a vampire.", "Volkihar Clan"),
            quests("Protecting the Bloodline", "Destroy a vampire before it turns its allies.", "Volkihar Clan"),
            quests("Rings of Blood Magic", "Retrieve the Ring of the Erudite and the Ring of the Beast.", "Volkihar Clan")
          ]},
        // ================== Dragonborn DLC ==================
        {
          key: "dragonborn",
          label: "Dragonborn DLC",
          color: "#2E8B57",
          filters: dragonbornDLC,
          quests: [  
            quests("Dragonborn", "Travel to the island of Solstheim.", "Main Dragonborn Quest"),
            quests("The Temple of Miraak", "Uncover the source of Miraak's power in the Temple of Miraak.", "Main Dragonborn Quest"),
            quests("The Fate of the Skaal", "Find a way to free the citizens of Skaal Village.", "Main Dragonborn Quest"),
            quests("Cleansing the Stones", "Use the Bend Will shout to cleanse the remaining All-Maker Stones.", "Main Dragonborn Quest"),
            quests("The Path of Knowledge", "Discover the locations of the Black Books.", "Main Dragonborn Quest"),
            quests("The Gardener of Men", "Travel to the realm of Hermaeus Mora to learn the rest of Bend Will.", "Main Dragonborn Quest"),
            quests("At the Summit of Apocrypha", "Confront Miraak at the summit of Apocrypha.", "Main Dragonborn Quest"),
            
            // Dragonborn Side Quests
            quests("Black Book", "Retrieve a Black Book.", "Side Dragonborn Quest"),
            quests("Deathbrand", "Find the treasure of Haknir Death-Brand.", "Side Dragonborn Quest"),
            quests("Hrodulf's House", "Uncover the secret of Hrodulf's House.", "Side Dragonborn Quest"),
            quests("Kolbjorn Barrow Misc Objectives", "Search for the relics of Ahzidal in Kolbjorn Barrow.", "Side Dragonborn Quest"),
            quests("Sell Stalhrim Equipment", "Sell stalhrim equipment to Ancarion at Northshore Landing.", "Side Dragonborn Quest"),
            quests("Summoning Karstaag", "Summon and defeat Karstaag.", "Side Dragonborn Quest"),
            quests("The Ebony Warrior", "Locate and defeat the Ebony Warrior.", "Side Dragonborn Quest"),
            quests("The Kagrumez Gauntlet", "Survive the Kagrumez trials to claim a unique prize.", "Side Dragonborn Quest"),
            quests("Unearthed", "Search for the relics of Ahzidal in Kolbjorn Barrow.", "Side Dragonborn Quest"),
            quests("Visit the hunters at Frostmoon Crag", "Talk to the hunters at Frostmoon Crag.", "Side Dragonborn Quest"),
            quests("An Axe to Find", "Retrieve an ancient Nordic pickaxe.", "Side Dragonborn Quest"),
            quests("Clean Sweep", "Clear the Temple Ancestral Tomb of ash spawn.", "Side Dragonborn Quest"),
            quests("Feeding the Addiction", "Convince an innkeeper to let a drunken miner get back to the bar.", "Side Dragonborn Quest"),
            quests("Fetch the Netch", "Obtain five samples of netch jelly.", "Side Dragonborn Quest"),
            quests("First Edition", "Locate an important folio.", "Side Dragonborn Quest"),
            quests("It's All In The Taste", "Distribute Sadri's Sujamma to the citizens of Raven Rock.", "Side Dragonborn Quest"),
            quests("March of the Dead", "Stop the ash spawn attacks.", "Side Dragonborn Quest"),
            quests("Paid in Full", "Recover bonemold formula.", "Side Dragonborn Quest"),
            quests("Pain in the Necklace", "Find East Empire pendants.", "Side Dragonborn Quest"),
            quests("Recipe for Distraction", "Locate a hidden stash of Emberbrand Wine.", "Side Dragonborn Quest"),
            quests("Served Cold", "Save Councilor Morvayn from an assassination plot.", "Side Dragonborn Quest"),
            quests("The Final Descent", "Find out what happened to the great-grandfather of Crescius Caerellius.", "Side Dragonborn Quest"),
            quests("A New Source of Stalhrim", "Find a missing blacksmith.", "Side Dragonborn Quest"),
            quests("Convince Nikulas to stay in Skaal Village", "Counsel a young Skaal on life as an adventurer.", "Side Dragonborn Quest"),
            quests("Filial Bonds", "Find Wulf Wild-Blood's brother.", "Side Dragonborn Quest"),
            quests("Lost Legacy", "Travel to Vahlok's Tomb.", "Side Dragonborn Quest"),
            quests("Skaal Village Dialogue", "Take Bera's necklace to Runil in Falkreath.", "Side Dragonborn Quest"),
            quests("Elmus Favor Quest (berries)", "Retrieve one sample of juniper berries.", "Side Dragonborn Quest"),
            quests("Elmus Favor Quest (mead)", "Retrieve one bottle of Ashfire Mead for Elmus.", "Side Dragonborn Quest"),
            quests("Halbarn Favor Quest", "Find 10 stalhrim samples and 15 ebony ingots.", "Side Dragonborn Quest"),
            quests("Hilund Favor Quest", "Find 50 Riekling spears for Hilund.", "Side Dragonborn Quest"),
            quests("Retaking Thirsk", "Help retake the Thirsk Mead Hall.", "Side Dragonborn Quest"),
            quests("The Chief of Thirsk Hall", "Help a Riekling Chief.", "Side Dragonborn Quest"),
            quests("Thirsk Rumors", "Investigate Thirsk Mead Hall.", "Side Dragonborn Quest"),
            quests("A New Debt", "Help Drovas Relvi with his debt to Mogrul.", "Side Dragonborn Quest"),
            quests("Azra's Staffs", "Retrieve a staff made by Azra Nightwielder.", "Side Dragonborn Quest"),
            quests("Briarheart Necropsy", "Examine a Briarheart.", "Side Dragonborn Quest"),
            quests("Experimental Subject (A)", "Be a test subject in an experiment.", "Side Dragonborn Quest"),
            quests("Experimental Subject (B)", "Be a test subject in an experiment.", "Side Dragonborn Quest"),
            quests("From the Ashes", "Help Talvas Fathryon by killing an ash guardian.", "Side Dragonborn Quest"),
            quests("Healing a House", "Help Elynea Mothren repair the tower of Tel Mithryn.", "Side Dragonborn Quest"),
            quests("Heart Stones", "Find a heart stone for Neloth.", "Side Dragonborn Quest"),
            quests("Hunting and Gathering", "Collect a rare alchemy ingredient.", "Side Dragonborn Quest"),
            quests("Lost Knowledge", "Retrieve the Black Books for Neloth.", "Side Dragonborn Quest"),
            quests("Old Friends", "Find the source of attacks on Tel Mithryn.", "Side Dragonborn Quest"),
            quests("Reluctant Steward", "Find a new steward in Raven Rock.", "Side Dragonborn Quest"),
            quests("Telvanni Research", "Extract a sample from an ash spawn for Neloth's research.", "Side Dragonborn Quest"),
            quests("Wind and Sand", "Retrieve a copy of Wind and Sand.", "Side Dragonborn Quest")
          ]}
      ];

      // ================== Checklist Helpers ==================
      function createTag(text, className){
        const s=document.createElement("span"); 
        s.className=`tag ${className}`; 
        s.textContent=text; 
        return s; 
      }

      function createChecklistItem(item,type,container){ 
        const id=`tes-skyrim-${type}-${item.title.replace(/\s+/g,"-").toLowerCase()}`;
        item.id = id;
        const li=document.createElement("li");
        const checkbox=document.createElement("input"); 
        checkbox.type="checkbox"; 
        checkbox.id=id; 
        checkbox.checked=localStorage.getItem(id)==="true";
        const label=document.createElement("label"); 
        label.setAttribute("for",id); 
        label.textContent=` ${item.title}`;
        checkbox.addEventListener("change",()=>{
          localStorage.setItem(id,checkbox.checked); 
          updateProgressByType(type); 
          updateAllStats();
        });
        li.append(checkbox,label); 

        if(item.tag){ 
          const tags=Array.isArray(item.tag)?item.tag:[item.tag]; 
          tags.forEach(t=>{ if(t) li.append(createTag(t,"tag"+t.replace(/\s+/g,""))); });
        }
        if(item.giver) li.append(createTag(item.giver,"tagGiver"));
        if(item.optional) li.append(createTag(item.optional,"tagOptional"));
        if(item.note) li.append(createTag(item.note,"tagNote"));

        container.appendChild(li);
      }

      // ================== Progress ==================
      function updateProgressByType(key){
        const category = questCategories.find(c => c.key === key);
        if(!category) return;

        const listEl = document.getElementById(`${key}-Quests`);
        const checkboxes = listEl.querySelectorAll("input[type=checkbox]");
        let completed = 0;
        checkboxes.forEach(cb => { if(cb.checked) completed++; });

        const progressEl = document.getElementById(`${key}-Progress`);
        if(progressEl) progressEl.textContent = `Completed ${completed} / ${checkboxes.length}`;
      }

      // ================== Filter Buttons ==================
      function setActiveButton(containerSelector, text){
        document.querySelectorAll(containerSelector+" .tab-button").forEach(btn=>btn.classList.remove("active"));
        document.querySelectorAll(containerSelector+" .tab-button").forEach(b=>{ if(b.textContent===text) b.classList.add("active"); });
      }

      function renderQuestList(category){
        const listEl = document.getElementById(`${category.key}-Quests`);
        if(!listEl) return;
        listEl.innerHTML = "";

        let filteredQuests = category.quests;
        if(category.activeFilter && category.activeFilter !== "All" && category.filters){
          filteredQuests = filteredQuests.filter(q=>q.tag === category.activeFilter);
        }

        filteredQuests.forEach(q => createChecklistItem(q, category.key, listEl));
        updateProgressByType(category.key);

        // Render filter buttons
        if(category.filters){
          const filterContainer = document.getElementById(`${category.key}-filters`);
          if(filterContainer){
            filterContainer.innerHTML = "";
            // Ensure "All" is first
            const filtersWithAll = ["All", ...category.filters.filter(f => f !== "All")];
            filtersWithAll.forEach(f=>{
              const btn=document.createElement("div");
              btn.className="tab-button"; 
              btn.textContent=f;
              btn.addEventListener("click", ()=>{
                category.activeFilter = f;
                renderQuestList(category);
              });
              filterContainer.appendChild(btn);
            });
            // Initialize activeFilter if undefined
            if(!category.activeFilter) category.activeFilter = "All";
            setActiveButton(`#${category.key}-filters`, category.activeFilter);
          }
        }
      }

      // ================== Initialize All Lists ==================
      questCategories.forEach(cat => renderQuestList(cat));

      // ================== GitHub Links ==================
      window.addEventListener("DOMContentLoaded",()=>{
        document.getElementById("faq-link-container").appendChild(document.getElementById("github-link-template-faq").content.cloneNode(true));
        document.getElementById("footer-link-container").appendChild(document.getElementById("github-link-template-footer").content.cloneNode(true));
      });

      // ================== Export/Import ==================
      function exportChecklist(){
        const data = { prefix:"tes-skyrim" };
        questCategories.forEach(cat=>{
          data[cat.key] = [];
          const listEl = document.getElementById(`${cat.key}-Quests`);
          listEl.querySelectorAll("input[type=checkbox]").forEach(cb=>{
            if(cb.checked) data[cat.key].push(cb.id.replace(`tes-skyrim-${cat.key}-`,""));
          });
        });
        const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
        const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="tes-skyrim-checklist.json"; a.click(); URL.revokeObjectURL(a.href);
      }

      function importChecklist(){
        const fileInput=document.getElementById("import-file");
        fileInput.click();
        fileInput.onchange=e=>{
          const file=e.target.files[0];
          if(!file) return;
          const reader=new FileReader();
          reader.onload=ev=>{
            try{
              const imported=JSON.parse(ev.target.result);
              if(imported.prefix !== "tes-skyrim"){ alert(`This checklist file is for a different game or project ("${imported.prefix}").`); return; }
              questCategories.forEach(cat=>{
                imported[cat.key]?.forEach(slug=>{
                localStorage.setItem(`tes-skyrim-${cat.key}-${slug}`,"true");
});
});
alert("Checklist progress imported! Refresh the page to see updates.");
} catch(err){ alert("Failed to import: Invalid file format."); }
};
reader.readAsText(file);
};
}

// ================== Stats Chart ==================
let combinedChart;

function updateAllStats(){
const allQuests = questCategories.flatMap(c=>c.quests);
const tagStats = {};

allQuests.forEach(q => {
  let prefix = questCategories.find(c => c.quests.includes(q))?.key;
  
  // Override key for side quests
  let key = (prefix === "side") ? "Side Quests" : (q.tag || questCategories.find(c => c.quests.includes(q))?.label || "Main Quests");

  const id = `tes-skyrim-${prefix}-${q.title.replace(/\s+/g,"-").toLowerCase()}`;
  const completed = localStorage.getItem(id) === "true";

  tagStats[key] = tagStats[key] || { completed: 0, total: 0 };
  tagStats[key].total++;
  if (completed) tagStats[key].completed++;
});

const labels = Object.keys(tagStats);
const data = labels.map(l => tagStats[l].completed);
const colorMap = {
"Main Quests": "#FFD700",
"Side Quests": "#87CEFA",
"College of Winterhold": "#9370DB",
"Bards College": "#FF69B4",
"Blades": "#A9A9A9",
"Companions": "#C0C0C0",
"Dark Brotherhood": "#4B0082",
"Thieves Guild": "#556B2F",
"Imperial Legion": "#B22222",
"Stormcloaks": "#1E90FF",
"Divines Quests": "#00CED1",
"Daedric Quests": "#8B0000",
"Main Dawnguard Quest": "#1E90FF",
"Side Dawnguard Quest": "#1E90FF",
"Dawnguard Faction": "#4682B4",
"Volkihar Clan": "#4B0082",
"Main Dragonborn Quest": "#FF8C00",
"Side Dragonborn Quest": "#FFA500"
};    

combinedChart?.destroy();
combinedChart = new Chart(document.getElementById("combinedChart").getContext("2d"), {
type: "doughnut",
data: { labels, datasets:[{ label:"Completed Quests", data, backgroundColor:labels.map(l=>colorMap[l]||"#aaa"), borderWidth:0 }] },
options:{ responsive:true, plugins:{ legend:{ position:"bottom" } } }
});

const container = document.getElementById("completed-by-type");
container.querySelectorAll(".category-stats,.total-stats").forEach(el=>el.remove());

const totalCompleted = allQuests.filter(q=>{
let prefix = questCategories.find(c=>c.quests.includes(q))?.key;
const id = `tes-skyrim-${prefix}-${q.title.replace(/\s+/g,"-").toLowerCase()}`;
return localStorage.getItem(id) === "true";
}).length;

const totalDiv = document.createElement("div");
totalDiv.classList.add("total-stats");
totalDiv.style.marginBottom = "10px";
totalDiv.innerHTML = `<strong>Total quests:</strong> <span style="color:#aaa">${allQuests.length}</span> <br><strong>Completed:</strong> <span style="color:#aaa">${((totalCompleted/allQuests.length)*100).toFixed(1)}%</span>`;
              container.appendChild(totalDiv);

              Object.entries(tagStats).forEach(([tag,s])=>{
                const percent = s.total ? (s.completed / s.total * 100).toFixed(1) : 0;
                const div=document.createElement("div");
                div.classList.add("category-stats");
                div.style.marginBottom="0px";
                div.innerHTML=`<strong>${tag}</strong>: ${s.completed} <span style="color:#aaa">(${percent}%)</span>`;
                container.appendChild(div);
              });
            }

    </script>

    <!-- ================== Footer ================== -->
    <footer style="text-align:center; margin-top:40px; font-size:0.9em; color:#aaa;">Check out the project or <span id="footer-link-container"></span>.</footer>

  </body>
</html>
